# Week 2 Day 7 - OpenCV Tracker 입문

**날짜**: 2024-10-12  
**소요 시간**: 1.5시간  
**타입**: 실습 & 체험

---

## 목표

Background Subtraction의 한계 확인 후,
OpenCV Tracker로 방향 전환.
수동 초기화 + 자동 추적 방식 시도.

---

## OpenCV Tracker 개념

### 수동 초기화란?

**방식**:
1. 사람: 첫 프레임에서 공 위치 클릭 (1번만)
2. 컴퓨터: 그 위치부터 자동 추적
3. 결과: 높은 성공률

### 자동 검출 vs 수동 초기화

**자동 검출** (Week 1-2):
- 컴퓨터가 알아서 찾기
- 결과: 50% 정확도
- 어려움: 작은 공, 빠른 속도

**수동 초기화** (Week 2 Day 7):
- 사람이 한 번 지정
- 컴퓨터가 추적
- 결과: 훨씬 높은 성공률

---

## 구현 과정

### 1. opencv-contrib-python 설치

**문제**: `opencv-python`에는 Tracker 없음
**해결**: `opencv-contrib-python` 설치
```bash
pip install --only-binary :all: opencv-contrib-python
```

### 2. CSRT Tracker 사용

**Tracker 종류**:
- CSRT: 가장 정확 (선택!)
- KCF: 빠름
- MIL: 안정적
- MOSSE: 매우 빠름

**선택 이유**: 정확도 최우선

### 3. 수동 초기화 구현
```python
# ROI 선택 (마우스)
bbox = cv2.selectROI("Select Ball", frame, False)

# Tracker 생성
tracker = cv2.TrackerCSRT.create()

# 초기화
tracker.init(frame, bbox)

# 자동 추적
while True:
    success, bbox = tracker.update(frame)
    if success:
        # 박스 그리기
```

---

## 실험 결과

### 실험 1: Frame 500 시작

**초기화**: 공이 리시버에게 가는 중
**결과**: 리시버 타격 순간 추적 실패
**원인**: 급격한 방향 전환, 가려짐

### 실험 2: 박스 설정 개선

**초기화**: 공이 리시버에게 가는 중 (더 좋은 박스)
**결과**: ✅ **50프레임 연속 추적 성공!**
- 리시버 타격 → 네트 넘어감까지
- Frame 500 → 550

**실패**: 상대방 타격 후
**원인**: 다시 급격한 변화

---

## 핵심 발견

### 1. 박스 설정의 중요성 ⭐

**좋은 박스**:
- 공보다 약간 여유
- 공이 중앙 위치
- 적절한 크기

**영향**:
- 좋은 박스: 50+ 프레임 추적
- 나쁜 박스: 몇 프레임만 추적

### 2. 추적 가능 구간

**성공** ✅:
- 한 랠리 내 포물선 궤적
- 부드러운 움직임
- 일관된 방향

**실패** ❌:
- 타격 순간
- 급격한 방향 전환
- 가려짐

### 3. 실용적 접근 가능

**전략**:
```
랠리 1: 초기화 → 50프레임 추적
랠리 2: 재초기화 → 50프레임 추적
...
```

**의미**:
- 완전 자동 아님
- 하지만 충분히 실용적
- 한 경기: 10-20회 초기화로 가능

---

## Tracker의 강점과 한계

### 강점 ✅

1. **높은 정확도**
   - 좋은 조건: 90%+
   - 우리 실험: 50프레임 연속

2. **간단한 사용법**
   - 수동 초기화만 하면 됨
   - 복잡한 필터링 불필요

3. **실시간 가능**
   - 빠른 처리 속도
   - 실용적

### 한계 ❌

1. **급격한 변화 대응 못함**
   - 타격 순간
   - 방향 전환

2. **가려짐 복구 불가**
   - 한번 놓치면 끝
   - 재초기화 필요

3. **완전 자동 아님**
   - 수동 개입 필요
   - 랠리마다 초기화

---

## 배운 교훈

### 1. 완벽한 해결책은 없다

**깨달음**:
- 자동 검출: 50%
- 수동 초기화: 한 랠리 내 높은 정확도
- 둘 다 장단점

### 2. 실용성의 중요성

**질문**: "완전 자동이 아니면 쓸모없나?"
**답**: 아니다!

- 수동 초기화 10-20회
- 자동 추적 수천 프레임
- 충분히 가치 있음

### 3. 점진적 개선

**Week 1**: 색상 검출 (실패)
**Week 2 Day 6**: Background Subtraction (50%)
**Week 2 Day 7**: Tracker (50프레임 연속!)

매번 진전!

---

## 다음 단계 (Day 8)

### 목표

1. **여러 랠리 추적**
   - 경기 영상 전체
   - 5-10개 랠리

2. **데이터 수집**
   - 각 랠리별 궤적
   - CSV 저장

3. **시각화**
   - 전체 궤적 그리기
   - 통계 분석

---

## 코드 산출물

- `test_tracker_basic.py` - 수동 초기화 + CSRT Tracker

---

## 참고 자료

- [OpenCV Tracking API](https://docs.opencv.org/4.x/d9/df8/group__tracking.html)
- [CSRT Tracker Paper](https://arxiv.org/abs/1611.08461)

---

## 회고

오늘은 큰 전환점이었다.

**Week 1-2 초반**: "완전 자동으로 공 찾기!"
**오늘**: "현실적으로 접근하자"

50프레임 연속 추적을 보는 순간,
"이거면 충분하다"는 생각이 들었다.

완벽을 추구하다 아무것도 못 이루는 것보다,
80% 해결책으로 실제 결과를 내는 게 낫다.

**내일 계획**:
여러 랠리를 추적해서 실제 데이터를 모아보자!